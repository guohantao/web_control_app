
<!DOCTYPE html>
<html lang="en">
	<head>
    	<meta charset="utf-8">
	    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <meta name="viewport" content="width=device-width, initial-scale=1">
	    <title>Proton - Admin Template</title>

		<!-- Import google fonts - Heading first/ text second -->
{#        <link rel='stylesheet' type='text/css' href='http://fonts.useso.com/css?family=Open+Sans:400,700|Droid+Sans:400,700' />#}
        <!--[if lt IE 9]>
<link href="http://fonts.useso.com/css?family=Open+Sans:400" rel="stylesheet" type="text/css" />
<link href="http://fonts.useso.com/css?family=Open+Sans:700" rel="stylesheet" type="text/css" />
<link href="http://fonts.useso.com/css?family=Droid+Sans:400" rel="stylesheet" type="text/css" />
<link href="http://fonts.useso.com/css?family=Droid+Sans:700" rel="stylesheet" type="text/css" />
<![endif]-->

		<!-- Favicon and touch icons -->
		<link rel="shortcut icon" href="/static/assets/ico/favicon.ico" type="image/x-icon" />

	    <!-- Css files -->
	    <link href="/static/assets/css/bootstrap.min.css" rel="stylesheet">
		<link href="/static/assets/css/jquery.mmenu.css" rel="stylesheet">
		<link href="/static/assets/css/font-awesome.min.css" rel="stylesheet">
		<link href="/static/assets/plugins/jquery-ui/css/jquery-ui-1.10.4.min.css" rel="stylesheet">
	    <link href="/static/assets/css/style.min.css" rel="stylesheet">
		<link href="/static/assets/css/add-ons.min.css" rel="stylesheet">

	    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	    <!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
			<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
	    <![endif]-->
        	<!-- start: JavaScript-->
	<!--[if !IE]>-->

			<script src="/static/assets/js/jquery-2.1.1.min.js"></script>

	<!--<![endif]-->

	<!--[if IE]>

		<script src="/static/assets/js/jquery-1.11.1.min.js"></script>

	<![endif]-->

	<!--[if !IE]>-->

		<script type="text/javascript">
			window.jQuery || document.write("<script src='/static/assets/js/jquery-2.1.1.min.js'>"+"<"+"/script>");
		</script>

	<!--<![endif]-->

	<!--[if IE]>

		<script type="text/javascript">
	 	window.jQuery || document.write("<script src='/static/assets/js/jquery-1.11.1.min.js'>"+"<"+"/script>");
		</script>

	<![endif]-->
	<script src="/static/assets/js/jquery-migrate-1.2.1.min.js"></script>
	<script src="/static/assets/js/bootstrap.min.js"></script>


	<!-- page scripts -->
	<script src="/static/assets/plugins/jquery-ui/js/jquery-ui-1.10.4.min.js"></script>
	<script src="/static/assets/plugins/datatables/js/jquery.dataTables.min.js"></script>
	<script src="/static/assets/plugins/datatables/js/dataTables.bootstrap.min.js"></script>

	<!-- theme scripts -->
	<script src="/static/assets/js/SmoothScroll.js"></script>
	<script src="/static/assets/js/jquery.mmenu.min.js"></script>
	<script src="/static/assets/js/core.min.js"></script>

	<!-- inline scripts related to this page -->
	<script src="/static/assets/js/pages/table.js"></script>

	<!-- end: JavaScript-->


	</head>
</head>






<body class="">
<<!-- start: Header -->
	<div class="navbar" role="navigation">

		<div class="container-fluid">

			<ul class="nav navbar-nav navbar-actions navbar-left">
				<li class="visible-md visible-lg"><a href="/table/" id="main-menu-toggle"><i class="fa fa-th-large"></i></a></li>
				<li class="visible-xs visible-sm"><a href="/table" id="sidebar-menu"><i class="fa fa-navicon"></i></a></li>
			</ul>

			<form action="/search_machine/" method="post" class="navbar-form navbar-left">
				<button type="submit"  class="fa fa-search"></button>
				<input type="text" name="machinesn" class="form-control" placeholder="Search by SN..."></a>
			</form>

	        <ul class="nav navbar-nav navbar-right">

                <li><a href="/user_set/"><i class="fa fa-cog"></i></a></li>

				<li class="dropdown visible-md visible-lg">
	        		<a href="#" class="dropdown-toggle" data-toggle="dropdown"><img class="user-avatar" src="/static/assets/img/avatar.jpg" alt="user-mail">{{ username }}</a>
	        		<ul class="dropdown-menu">
						<li class="dropdown-menu-header">
							<strong>Account</strong>
						</li>
						<li><a href="/login/"><i class="fa fa-user"></i> 登录</a></li>
{#						<li><a href="page-login.html"><i class="fa fa-wrench"></i> </a></li>#}
{#						<li><a href="page-invoice.html"><i class="fa fa-usd"></i> Payments <span class="label label-default">10</span></a></li>#}
						<li><a href="/user_set/"><i class="fa fa-cog"></i> 账户管理 </a></li>
{#						<li class="divider"></li>#}
						<li><a href="/logout/"><i class="fa fa-sign-out"></i> 注销</a></li>
	        		</ul>
	      		</li>
				<li><a href="/logout/"><i class="fa fa-power-off"></i></a></li>
			</ul>

		</div>

	</div>
	<!-- end: Header -->
<div class="sidebar  mm-menu mm-horizontal mm-offcanvas"><div class="sidebar-collapse mm-panel mm-opened mm-current" id="mm-0">
					<div class="sidebar-header t-center">
                        <span><img class="text-logo" src="/static/assets/img/logo1.png"><i class="fa fa-space-shuttle fa-3x blue"></i></span>
                    </div>
					<div class="sidebar-menu opened" style="height: 233px;">
						<ul class="nav nav-sidebar">
							<li class="active opened"><a href="/"><i class="fa fa-code-fork"></i><span class="text"> 主页</span></a></li>
							<li>
								<a href="#"><i class="fa fa-laptop"></i><span class="text"> 我的设备</span> <span class="fa fa-angle-down pull-right"></span></a>
								<ul class="nav sub">
                                    <li><a href="/table/"><i class="fa fa-table"></i><span class="text"> 设备管理</span></a></li>
                                    <li><a href="/warning_history/"><i class="fa fa-bell"></i><span class="text"> 报警历史</span></a></li>
								</ul>
							</li>
                            <li>
								<a href="#"><i class="fa fa-comment"></i><span class="text"> 通知组</span> <span class="fa fa-angle-down pull-right"></span></a>
								<ul class="nav sub">
                                    <li><a href="/developer/"><i class="fa fa-eye"></i><span class="text"> 作者信息</span></a></li>
								</ul>
							</li>
                            <li><a href="/user_set/"><i class="fa fa-cog"></i><span class="text"> 设置</span></a></li>

                            <li><a href="/logout/"><i class="fa fa-power-off"></i><span class="text"> 退出登录</span></a></li>





{#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#}



{#                                                                                                                       以上为我们所用的                  #}





                        </ul>
                    </div>




				</div>
    <div class="sidebar-footer drop-shadow mm-panel mm-hidden" id="mm-1">





				</div></div>


<div class="row">

			<!-- start: Main Menu -->

			<!-- end: Main Menu -->
{#-----------------------------------------------------------------表格---------------------------------------------------------------------------#}
		<!-- start: Content -->
		<div class="main sidebar-minified" style="min-height: 540px;">

			<div class="row">
				<div class="col-lg-12">
					<h3 class="page-header"><i class="fa fa-table"></i>我的设备</h3>
					<ol class="breadcrumb">
						<li><i class="fa fa-home"></i><a href="/">Home</a></li>
						<li><i class="fa fa-table"></i>设备管理</li>
					</ol>
				</div>
			</div>

{#设备表格#}
			<div class="row">
				<div class="col-lg-12">
					<div class="panel panel-default">
						<div class="panel-heading">
							<h2><i class="fa fa-table red"></i><span class="break"></span><strong>设备列表</strong></h2>
							<div class="panel-actions">
								<a href="table.html#" class="btn-setting"><i class="fa fa-rotate-right"></i></a>
								<a href="table.html#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
								<a href="table.html#" class="btn-close"><i class="fa fa-times"></i></a>
							</div>
						</div>
						<div class="panel-body" style="display: block;">
							<table id="machine_table" class="table table-striped table-bordered bootstrap-datatable datatable">
							  <thead>
								  <tr>
                                      <th class="hidden">id</th>
									  <th>SN</th>
                                      <th>名称</th>
                                      <th>温度</th>
									  <th>上次更新</th>
                                      <th>报警</th>
                                      <th>状态</th>
									  <th>操作</th>
								  </tr>
							  </thead>
							  <tbody>
                                <tr>
                                    <td  id="machine_id" class="hidden">{{ machine.id }}</td>
                                    <td>{{ machine.SN }}</td>
                                    <td>{{ machine.name }}</td>
                                    <td>{{ machine.temperature }}</td>
                                    <td>{{ machine.time }}</td>
                                    <td>{{ machine.warning }}</td>
                                    <td>{{ machine.state }}</td>

                                    <td>
										<a class="btn btn-success" href="/detail/?machineid={{ machine.id }}">
											<i class="fa fa-search-plus "></i>
										</a>
										<a class="btn btn-info" href="/update/?machineid={{ machine.id }}">
											<i class="fa fa-edit "></i>
										</a>
                                </tr>
							  </tbody>

						  </table>
						</div>
					</div>
				</div><!--/col-->
            </div>

             <div class="row">
                 {#设备报警历史记录表#}
				<div class="col-lg-4">
					<div class="panel panel-default">
						<div class="panel-heading">
							<h2><i class="fa fa-table red"></i><span class="break"></span><strong>报警历史表</strong></h2>
							<div class="panel-actions">
								<a href="table.html#" class="btn-setting"><i class="fa fa-rotate-right"></i></a>
								<a href="table.html#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
								<a href="table.html#" class="btn-close"><i class="fa fa-times"></i></a>
							</div>
						</div>
						<div class="panel-body" style="display: block;">
							<table id="warning_table" class="table table-striped table-bordered bootstrap-datatable datatable">
							  <thead>
								  <tr>
									  <th>报警状态</th>
									  <th>时间</th>
								  </tr>
							  </thead>
							  <tbody>
                                <tr>
                                </tr>
							  </tbody>
						  </table>
                            <p id="qwe"></p>
						</div>
					</div>
				</div><!--/col-->

{#                         设备温度记录表#}
                <div class="col-lg-4">
					<div class="panel panel-default">
						<div class="panel-heading">
							<h2><i class="fa fa-table red"></i><span class="break"></span><strong>温度历史表</strong></h2>
							<div class="panel-actions">
								<a href="table.html#" class="btn-setting"><i class="fa fa-rotate-right"></i></a>
								<a href="table.html#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
								<a href="table.html#" class="btn-close"><i class="fa fa-times"></i></a>
							</div>
						</div>
						<div class="panel-body" style="display: block;">
							<table id="temperature_table" class="table table-striped table-bordered bootstrap-datatable datatable">
							  <thead>
								  <tr>
									  <th>温度</th>
                                      <th>时间</th>
								  </tr>
							  </thead>
							  <tbody>
                                <tr>
                                </tr>
							  </tbody>
						  </table>
						</div>
					</div>
				</div><!--/col-->

                 {#            设备状态记录表#}

                 <div class="col-lg-4">
					<div class="panel panel-default">
						<div class="panel-heading">
							<h2><i class="fa fa-table red"></i><span class="break"></span><strong>状态变更历史表</strong></h2>
							<div class="panel-actions">
								<a href="table.html#" class="btn-setting"><i class="fa fa-rotate-right"></i></a>
								<a href="table.html#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
								<a href="table.html#" class="btn-close"><i class="fa fa-times"></i></a>
							</div>
						</div>
						<div class="panel-body" style="display: block;">
							<table id="state_table" class="table table-striped table-bordered bootstrap-datatable datatable">
							  <thead>
								  <tr>
									  <th>状态</th>
                                      <th>时间</th>
								  </tr>
							  </thead>
							  <tbody>
                                <tr>
                                </tr>
							  </tbody>
						  </table>
						</div>
					</div>
				</div><!--/col-->


            </div>
        </div>

{#     动态刷新脚本      #}
{#    $("#qwe").text((new Date()).toString());  获取当前时间#}
 <script>
        $(document).ready(function () {
            setInterval("startRequest()",1500);

        });



{# d动态定时刷 温度 状态 报警三个表#}
        function startRequest()
        {
{#            post方式  记得关csrf 否则不能提交数据#}
            $.ajax(
                {
                    url:"/logtable/",
                    type: "POST",
                    data:{"machineid":$("#machine_id").text()},
                    dataType: "JSON",
                    success: function (data) {
                        var id= $("#machine_id").text();
                        reload_machine_table(id)
                        reload_table(data)

                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        //alert("出现未知错误，请手动刷新"+jqXHR+textStatus+errorThrown)
                    }
                }
            )
        }

        function reload_table(data) {
            //state_table
            $("#state_table").children("tbody").empty()
                var htmlstr = ""
                for (var i = 0; i < data.state_log.length; i++) {
                    htmlstr = htmlstr + "<tr>" +
                        "<td>" + data.state_log[i].state + "</td>" +
                        "<td>" + data.state_log[i].time + "</td>" +
                        "</tr>"
                }
                $("#state_table").children("tbody").html(htmlstr);

            //temperature table
            $("#temperature_table").children("tbody").empty()
                var htmlstr = ""
                for (var i = 0; i < data.temperature_log.length; i++) {
                    htmlstr = htmlstr + "<tr>" +
                        "<td>" + data.temperature_log[i].temperature + "</td>" +
                        "<td>" + data.temperature_log[i].time + "</td>" +
                        "</tr>"
                }
                $("#temperature_table").children("tbody").html(htmlstr);



            //warning_table
            $("#warning_table").children("tbody").empty()
                var htmlstr = ""
                for (var i = 0; i < data.warning_log.length; i++) {
                    htmlstr = htmlstr + "<tr>" +
                        "<td>" + data.warning_log[i].warning + "</td>" +
                        "<td>" + data.warning_log[i].time + "</td>" +
                        "</tr>"
                }
                $("#warning_table").children("tbody").html(htmlstr);

        }




                function reload_machine_table (id)
            {
                $.ajax(
                    {
                        url:"/AjaxTable/",
                        type:"GET",
                        dataType:"JSON",
                        success: function (data) {
                            $("#machine_table").children("tbody").empty();
                            var htmlstr = "";
                            var flag = 0;
                            for(var i=0 ; i< data.machinelist.length; i++)
                            {
                                if(data.machinelist[i].id == id)
                                {
                                    flag=1;
                                    break;
                                }
                            }
                            if(flag == 0)
                            {
                                alert("未找到该设备，出错")
                                return 0;
                            }
                            htmlstr = htmlstr + "<tr>" +
                                "<td  id='machine_id' class='hidden'>" + data.machinelist[i].id + "</td>" +
                                "<td>" + data.machinelist[i].SN + "</td>" +
                                "<td>" + data.machinelist[i].name + "</td>" +
                                "<td>" + data.machinelist[i].temperature + "</td>" +
                                "<td>" + data.machinelist[i].time + "</td>" +
                                "<td>" + data.machinelist[i].warning + "</td>" +
                                "<td>" + data.machinelist[i].state + "</td>" +
                                "<td>" + "<a class='btn btn-success'id='detail_button' href='/detail/?machineid=" + data.machinelist[i].id + "' > <i class='fa fa-search-plus '></i> </a>" +" "+
                                "<a class='btn btn-info' id='change_button' href='/update/?machineid=" + data.machinelist[i].id + "'> <i class='fa fa-edit'></i> </a>" +" "+
                                "</tr>";

                            $("#machine_table").children("tbody").html(htmlstr);
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                               alert("machine_table刷新错误");
                        }
                    }
                )
            }
</script>


			<!--/row-->






</div><!--/container-->


	<div class="modal fade" id="myModal" aria-hidden="true" style="display: none;">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					<h4 class="modal-title">Modal title</h4>
				</div>
				<div class="modal-body">
					<p>Here settings can be configured...</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					<button type="button" class="btn btn-primary">Save changes</button>
				</div>
			</div><!-- /.modal-content -->
		</div><!-- /.modal-dialog -->
	</div><!-- /.modal -->

	<div class="clearfix"></div>



</div></div><div id="mm-blocker"></div></div>
	<!-- start: Header -->

	<!-- end: Header -->


<div id="mm-blocker"></div>
</body>
</html>